<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tyre Analysis System - Enterprise Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .hidden { display: none !important; }
        
        /* Historical Version Alert */
        @keyframes pulse-border {
            0%, 100% { border-color: #f59e0b; }
            50% { border-color: #fbbf24; }
        }
        
        .historical-alert {
            animation: pulse-border 2s ease-in-out infinite;
        }
        
        /* Hover Popup Styles */
        .hover-popup {
            position: absolute;
            z-index: 100;
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 12px;
            display: none;
            pointer-events: none;
        }
        
        .hover-trigger:hover .hover-popup {
            display: block;
        }
        
        /* Custom scrollbar for popup */
        .hover-popup::-webkit-scrollbar {
            width: 6px;
        }
        
        .hover-popup::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .hover-popup::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .hover-popup::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Recipe row hover effect */
        .recipe-row {
            transition: all 0.2s ease;
        }
        
        .recipe-row:hover {
            background-color: #eff6ff !important;
            cursor: pointer;
        }
        
        .recipe-name-cell {
            cursor: pointer;
        }
        
        .recipe-name-cell:hover {
            color: #2563eb;
            text-decoration: underline;
        }
        
        /* Grade button hover */
        .grade-button {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .grade-button:hover {
            transform: scale(1.1);
        }

        /* Enhanced scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%);
            border-radius: 10px;
            border: 2px solid #f1f5f9;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #94a3b8 0%, #64748b 100%);
        }

        ::-webkit-scrollbar-thumb:active {
            background: #2563eb;
        }

        /* Edit icon styles */
        .edit-icon {
            cursor: pointer;
            color: #2563eb;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: transparent;
            position: relative;
        }

        .edit-icon:hover {
            color: white;
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }

        .edit-icon:active {
            transform: translateY(0);
        }

        /* Null value styling */
        .row-null {
            background: #fff1f2;
            border-left: 3px solid #ef4444;
        }

        .row-null:hover {
            background: #ffe4e6;
        }

        .cell-null {
            color: #ef4444;
            font-weight: 600;
            font-style: italic;
        }

        /* Status badges */
        .recipe-status-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 700;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .recipe-status-completed {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .recipe-status-pending {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .status-completed {
            border-left: 4px solid #10b981;
        }

        .status-pending {
            border-left: 4px solid #f59e0b;
        }

        /* Table styling */
        .parameter-table {
            font-size: 13px;
        }

        .parameter-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .parameter-table th {
            padding: 14px 16px;
            font-weight: 700;
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-size: 11px;
        }

        .parameter-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
        }

        .parameter-table tbody tr {
            transition: all 0.2s ease;
        }

        .parameter-table tbody tr:hover {
            background: #f8fafc;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transform: translateX(2px);
        }

        /* Inline editing */
        .inline-edit-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 13px;
            border: 2px solid #2563eb;
            border-radius: 6px;
            background: white;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .inline-edit-input:focus {
            outline: none;
            border-color: #1d4ed8;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
        }
    </style>
</head>
<body class="font-sans bg-gray-100">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md border-2 border-gray-200">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i data-lucide="shield-check" class="w-8 h-8 text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Tyre Analysis System</h1>
                <p class="text-gray-600 mt-2">Enterprise Quality Control Portal</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Role</label>
                    <select id="loginRole" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all">
                        <option value="">Select Role</option>
                        <option value="rpscoe">RPSCoE</option>
                        <option value="btp-quality">BTP Quality</option>
                        <option value="btp-technical">BTP Technical</option>
                    </select>
                </div>
                
                <button onclick="login()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white p-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transform hover:scale-[1.02] transition-all shadow-lg">
                    LOGIN
                </button>
                
                <div class="text-center space-y-2 text-sm pt-4">
                    <a href="#" class="text-blue-600 hover:underline block">Forgot Password?</a>
                    <p class="text-gray-600">Contact IT Helpdesk</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-700 to-blue-600 text-white shadow-lg">
            <div class="max-w-[1600px] mx-auto p-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-md">
                            <i data-lucide="gauge" class="w-7 h-7 text-blue-700"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">Tyre Analysis Dashboard</h1>
                            <p class="text-sm text-blue-100">Enterprise Quality Control System</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-sm text-blue-100">Logged in as</p>
                            <p class="font-semibold" id="userRoleDisplay">RPSCoE</p>
                        </div>
                        <button onclick="logout()" class="px-4 py-2 bg-blue-800 rounded-lg hover:bg-blue-900 flex items-center gap-2 font-semibold transition-all">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            LOGOUT
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="bg-white border-b-2 border-gray-200 shadow-sm">
            <div class="max-w-[1600px] mx-auto flex gap-2 p-3">
                <button onclick="switchTab('rpscoe')" id="tab-rpscoe" class="px-6 py-2.5 rounded-lg flex items-center gap-2 bg-blue-600 text-white font-semibold transition-all">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    RPSCoE Configuration
                </button>
                <button onclick="switchTab('btp')" id="tab-btp" class="px-6 py-2.5 rounded-lg flex items-center gap-2 bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold transition-all">
                    <i data-lucide="clipboard-check" class="w-4 h-4"></i>
                    BTP Quality
                </button>
                <button onclick="switchTab('comparison')" id="tab-comparison" class="px-6 py-2.5 rounded-lg flex items-center gap-2 bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold transition-all">
                    <i data-lucide="git-compare" class="w-4 h-4"></i>
                    Data Comparison
                </button>
                <button onclick="switchTab('dashboard')" id="tab-dashboard" class="px-6 py-2.5 rounded-lg flex items-center gap-2 bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold transition-all">
                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                    Analytics Dashboard
                </button>
                <button onclick="switchTab('reports')" id="tab-reports" class="px-6 py-2.5 rounded-lg flex items-center gap-2 bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold transition-all">
                    <i data-lucide="file-text" class="w-4 h-4"></i>
                    Reports
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <main class="max-w-[1600px] mx-auto p-6">
            <!-- RPSCoE Tab -->
            <div id="content-rpscoe" class="space-y-6">
                <!-- Control Bar -->
                <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                    <div class="flex justify-between items-center gap-4">
                        <div class="flex items-center gap-3 flex-1">
                            <select id="rpscoeRecipeSelect" onchange="handleRPSCoERecipeChange()" class="p-3 border-2 border-gray-300 rounded-lg text-sm min-w-[250px] focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all font-semibold">
                                <option value="">Select Recipe</option>
                            </select>
                            <select id="rpscoeVersionSelect" disabled class="p-3 border-2 border-gray-300 rounded-lg text-sm min-w-[200px] focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all font-semibold">
                                <option value="">Select Version</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="resetRPSCoE()" class="px-6 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-all flex items-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                Reset
                            </button>
                            <button id="saveTargetSpecsBtn" onclick="saveTargetSpecs()" disabled class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold transition-all shadow-md flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-500">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                Save Target Specs
                            </button>
                            <button onclick="openLogHistory('rpscoe')" class="px-6 py-2.5 bg-gray-700 text-white rounded-lg hover:bg-gray-800 font-semibold transition-all flex items-center gap-2">
                                <i data-lucide="history" class="w-4 h-4"></i>
                                Log History
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Work Area -->
                <div id="rpscoeWorkArea" class="grid grid-cols-2 gap-6" style="display: none;">
                    <!-- Parameters Panel -->
                    <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex flex-col" style="height: calc(100vh - 280px);">
                        <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <i data-lucide="list-checks" class="w-5 h-5 text-blue-600"></i>
                                Parameters & Target Specifications
                            </h3>
                        </div>
                        <div class="overflow-y-auto flex-1">
                            <table class="w-full parameter-table">
                                <thead>
                                    <tr>
                                        <th class="text-left border-b-2 border-gray-300">Parameter Name</th>
                                        <th class="text-left border-b-2 border-gray-300">Target Spec</th>
                                        <th class="text-center border-b-2 border-gray-300" style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="rpscoeParametersBody">
                                    <!-- Parameters will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- DWG & Notifications Panel -->
                    <div class="flex flex-col gap-6" style="height: calc(100vh - 280px);">
                        <!-- DWG Preview -->
                        <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex-1">
                            <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                    <i data-lucide="file-image" class="w-5 h-5 text-blue-600"></i>
                                    DWG Design Preview
                                </h3>
                            </div>
                            <div class="p-8 flex items-center justify-center h-full bg-gray-50">
                                <div class="text-center">
                                    <i data-lucide="image" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                    <p class="text-gray-500 font-medium">DWG Preview will appear here</p>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Log Notifications -->
                        <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex-1">
                            <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                    <i data-lucide="bell" class="w-5 h-5 text-blue-600"></i>
                                    Edit Log Notifications
                                </h3>
                            </div>
                            <div class="p-4 space-y-2 overflow-y-auto" style="max-height: 300px;">
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="edit-3" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">10:22 – Tread Width updated</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">14:45 – Version changed to v1.3</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">11:10 – Specs synced from DWG</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recipe Selection View -->
                <div id="rpscoeRecipeList" class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Select Recipe to Configure</h3>
                    <div id="rpscoeRecipeListContainer" class="grid grid-cols-3 gap-4">
                        <!-- Recipe cards will be populated here -->
                    </div>
                </div>
            </div>

            <!-- BTP Tab -->
            <div id="content-btp" class="hidden space-y-6">
                <!-- Similar structure as RPSCoE but for BTP -->
                <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                    <div class="flex justify-between items-center gap-4">
                        <div class="flex items-center gap-3 flex-1">
                            <select id="btpRecipeSelect" onchange="handleBTPRecipeChange()" class="p-3 border-2 border-gray-300 rounded-lg text-sm min-w-[250px] focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all font-semibold">
                                <option value="">Select Recipe</option>
                            </select>
                            <select id="btpVersionSelect" disabled class="p-3 border-2 border-gray-300 rounded-lg text-sm min-w-[200px] focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all font-semibold">
                                <option value="">Select Version</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="resetBTP()" class="px-6 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-all flex items-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                Reset
                            </button>
                            <button onclick="openLogHistory('btp')" class="px-6 py-2.5 bg-gray-700 text-white rounded-lg hover:bg-gray-800 font-semibold transition-all flex items-center gap-2">
                                <i data-lucide="history" class="w-4 h-4"></i>
                                Log History
                            </button>
                        </div>
                    </div>
                </div>

                <!-- BTP Work Area -->
                <div id="btpWorkArea" class="grid grid-cols-2 gap-6" style="display: none;">
                    <!-- Measurement Table -->
                    <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex flex-col" style="height: calc(100vh - 280px);">
                        <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <i data-lucide="ruler" class="w-5 h-5 text-blue-600"></i>
                                Quality Measurements
                            </h3>
                        </div>
                        <div class="overflow-y-auto flex-1">
                            <table class="w-full parameter-table">
                                <thead>
                                    <tr>
                                        <th class="text-left border-b-2 border-gray-300">Parameter</th>
                                        <th class="text-left border-b-2 border-gray-300">Target Spec</th>
                                        <th class="text-center border-b-2 border-gray-300">Actual 1</th>
                                        <th class="text-center border-b-2 border-gray-300">Actual 2</th>
                                        <th class="text-center border-b-2 border-gray-300">Actual 3</th>
                                    </tr>
                                </thead>
                                <tbody id="btpMeasurementsBody">
                                    <!-- Measurements will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Scan Status & Notifications -->
                    <div class="flex flex-col gap-6" style="height: calc(100vh - 280px);">
                        <!-- Pending Scans -->
                        <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex-1">
                            <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                    <i data-lucide="clock" class="w-5 h-5 text-yellow-600"></i>
                                    Recipes Pending for Scanning
                                </h3>
                            </div>
                            <div class="p-4 space-y-2 overflow-y-auto" id="btpPendingScans" style="max-height: 300px;">
                                <!-- Pending recipes will be populated here -->
                            </div>
                        </div>

                        <!-- Edit Log Notifications -->
                        <div class="bg-white rounded-xl border-2 border-gray-200 shadow-sm overflow-hidden flex-1">
                            <div class="bg-gradient-to-r from-gray-50 to-white p-4 border-b-2 border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                    <i data-lucide="bell" class="w-5 h-5 text-blue-600"></i>
                                    Edit Log Notifications
                                </h3>
                            </div>
                            <div class="p-4 space-y-2 overflow-y-auto" style="max-height: 300px;">
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="upload" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">10:30 – Actuals uploaded (Recipe A)</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="calendar" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">11:15 – Schedule date updated</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-blue-50 border-l-4 border-blue-600 rounded-lg">
                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                    <span class="text-sm text-gray-700">12:05 – Version synced</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BTP Recipe List -->
                <div id="btpRecipeList" class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                    <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-6">
                        <div class="flex items-center gap-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600"></i>
                            <p class="text-sm text-blue-700">
                                <strong>Recipe Status Overview</strong> - Green badges indicate completed measurements, yellow badges show pending measurements.
                            </p>
                        </div>
                    </div>
                    <div id="btpRecipeListContainer" class="grid grid-cols-3 gap-4">
                        <!-- Recipe cards will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Data Comparison Tab -->
            <div id="content-comparison" class="hidden">
                <!-- This will contain the full data comparison interface from the second system -->
                <div class="space-y-6">
                    <!-- Historical Version Alert -->
                    <div id="historicalAlert" class="hidden bg-yellow-50 border-4 historical-alert rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <i data-lucide="alert-triangle" class="w-6 h-6 text-yellow-600"></i>
                                <div>
                                    <p class="font-bold text-yellow-800">You are viewing historical data</p>
                                    <p class="text-sm text-yellow-700">Version: <span id="historicalVersionText">v4</span> | This is not the current active version</p>
                                </div>
                            </div>
                            <button onclick="loadLatestVersion()" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 font-medium">
                                Switch to Latest
                            </button>
                        </div>
                    </div>
                    
                    <!-- Comparison Table -->
                    <div class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-4">
                                <h2 class="text-xl font-bold">Master Data vs Measured Data Comparison</h2>
                                <div id="overallGradeContainer" class="hidden flex items-center gap-2">
                                    <span class="text-sm font-medium text-gray-600">Overall Grade:</span>
                                    <span id="overallGradeBadge" class="px-4 py-1 rounded font-bold text-white text-lg bg-green-600">A</span>
                                </div>
                            </div>
                            <div class="flex gap-2 items-center">
                                <select id="comparisonRecipeSelect" onchange="handleComparisonRecipeChange()" class="p-2 border-2 border-gray-300 rounded text-sm min-w-[200px]">
                                    <option value="">Select Recipe</option>
                                </select>
                                
                                <!-- Version Selector -->
                                <div id="versionControls" class="hidden flex items-center gap-2">
                                    <div class="h-8 w-px bg-gray-300"></div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm font-medium text-gray-600">Data Version:</span>
                                        <select id="versionSelect" onchange="handleVersionChange()" class="p-2 border-2 border-gray-300 rounded text-sm">
                                            <option value="v5">v5 (Latest) - Jan 08, 2026</option>
                                            <option value="v4">v4 - Jan 07, 2026</option>
                                            <option value="v3">v3 - Jan 06, 2026</option>
                                        </select>
                                    </div>
                                    <button onclick="openVersionHistory()" class="px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 flex items-center gap-2">
                                        <i data-lucide="history" class="w-4 h-4"></i>
                                        View History
                                    </button>
                                </div>
                                
                                <!-- Version Status Indicator -->
                                <div id="versionIndicator" class="hidden items-center gap-2 px-3 py-2 rounded bg-green-100 border-2 border-green-500">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                                    <span class="text-xs font-bold text-green-700">LATEST</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recipe Overview Table -->
                        <div id="recipeSelectionView" class="bg-white rounded-lg">
                            <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-6">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="info" class="w-5 h-5 text-blue-600"></i>
                                    <p class="text-sm text-blue-700">
                                        <strong>Available Recipes</strong> - Click a recipe name for full details, and click the Overall Grade to view the complete analysis report.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse">
                                    <thead>
                                        <tr class="bg-gray-200">
                                            <th class="border-2 border-gray-300 p-3 text-left">Recipe Name</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-blue-50">Master Data</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 1</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 2</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 3</th>
                                            <th class="border-2 border-gray-300 p-3 text-center">Overall Grade</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recipeTableBody">
                                        <!-- Table rows will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Data Comparison Table -->
                        <div id="dataComparisonTable" class="hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse">
                                    <thead>
                                        <tr class="bg-gray-200">
                                            <th class="border-2 border-gray-300 p-3 text-left">Parameter Name</th>
                                            <th class="border-2 border-gray-300 p-3 text-left bg-blue-50">Master Data</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 1</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 2</th>
                                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 3</th>
                                            <th class="border-2 border-gray-300 p-3 text-center">Overall Grade</th>
                                        </tr>
                                    </thead>
                                    <tbody id="parameterTableBody">
                                        <!-- Table rows will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comparison Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded-xl border-2 border-green-300 shadow-sm">
                            <div class="text-sm font-medium text-gray-600">Parameters Passed (A+B)</div>
                            <div class="text-3xl font-bold text-green-700" id="passedCount">0/44</div>
                            <div class="text-xs text-gray-600 mt-1" id="passedPercent">No Recipe Selected</div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-xl border-2 border-yellow-300 shadow-sm">
                            <div class="text-sm font-medium text-gray-600">Alert Status (C)</div>
                            <div class="text-3xl font-bold text-yellow-700" id="alertCount">0/44</div>
                            <div class="text-xs text-gray-600 mt-1" id="alertStatus">No Recipe Selected</div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-xl border-2 border-red-300 shadow-sm">
                            <div class="text-sm font-medium text-gray-600">Failed (D)</div>
                            <div class="text-3xl font-bold text-red-700" id="failedCount">0/44</div>
                            <div class="text-xs text-gray-600 mt-1" id="failedStatus">No Recipe Selected</div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-xl border-2 border-blue-300 shadow-sm">
                            <div class="text-sm font-medium text-gray-600">Overall Grade</div>
                            <div class="text-3xl font-bold text-green-700" id="overallGrade">-</div>
                            <div class="text-xs text-gray-600 mt-1" id="overallStatus">No Recipe Selected</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Tab -->
            <div id="content-dashboard" class="hidden space-y-6">
                <!-- Filters Section -->
                <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                    <h3 class="font-bold mb-3 text-lg">Filters</h3>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium mb-1">Date Range</label>
                            <select class="w-full p-2 border-2 border-gray-300 rounded-lg">
                                <option>Last 7 Days</option>
                                <option>Last 30 Days</option>
                                <option>Last Quarter</option>
                                <option>Custom Range</option>
                            </select>
                        </div>
                        
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium mb-1">Grade Filter</label>
                            <select class="w-full p-2 border-2 border-gray-300 rounded-lg">
                                <option>All Grades</option>
                                <option>Grade A Only</option>
                                <option>Grade B Only</option>
                                <option>Grade C Only</option>
                                <option>Grade D Only</option>
                                <option>Grade C & D</option>
                            </select>
                        </div>
                        
                        <div class="flex-1 min-w-[200px]">
                            <label class="block text-sm font-medium mb-1">Deviation Filter</label>
                            <select class="w-full p-2 border-2 border-gray-300 rounded-lg">
                                <option>All Deviations</option>
                                <option>No Deviation</option>
                                <option>Minor Deviation (&lt;5%)</option>
                                <option>Major Deviation (&gt;5%)</option>
                                <option>Critical Deviation (&gt;10%)</option>
                            </select>
                        </div>
                        
                        <div class="flex items-end">
                            <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 h-[42px] font-semibold">
                                APPLY FILTERS
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- KPI Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4">
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Overall Compliance</span>
                            <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-gray-800">87%</div>
                        <div class="text-xs text-gray-600 mt-1">Target: 85%</div>
                        <div class="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-2 bg-green-500 rounded-full" style="width: 87%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Total Tyres Tested</span>
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-blue-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-gray-800">1,420</div>
                        <div class="text-xs text-gray-600 mt-1">Last 30 Days</div>
                        <div class="text-xs text-green-600 mt-1 flex items-center gap-1">
                            <i data-lucide="trending-up" class="w-3 h-3"></i>
                            12% vs last month
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Grade A Tyres</span>
                            <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-green-700">856</div>
                        <div class="text-xs text-gray-600 mt-1">60.3% of total</div>
                        <div class="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-2 bg-green-500 rounded-full" style="width: 60.3%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Active Batches</span>
                            <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-gray-800">24</div>
                        <div class="text-xs text-gray-600 mt-1">In Production</div>
                        <div class="text-xs text-blue-600 mt-1">3 pending review</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Deviations (C+D)</span>
                            <i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-yellow-700">102</div>
                        <div class="text-xs text-gray-600 mt-1">7.2% of total</div>
                        <div class="text-xs text-red-600 mt-1">23 critical (D grade)</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">Avg Processing Time</span>
                            <i data-lucide="clock" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <div class="text-3xl font-bold text-gray-800">2.4h</div>
                        <div class="text-xs text-gray-600 mt-1">Per Batch</div>
                        <div class="text-xs text-green-600 mt-1 flex items-center gap-1">
                            <i data-lucide="trending-down" class="w-3 h-3"></i>
                            8% improvement
                        </div>
                    </div>
                </div>
                
                <!-- Trend Graphs -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Compliance Trend -->
                    <div class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i data-lucide="trending-up" class="w-5 h-5 text-blue-600"></i>
                            Compliance Trend - Last 30 Days
                        </h3>
                        <div class="space-y-2">
                            <div class="flex items-end justify-between h-48 border-l-2 border-b-2 border-gray-400 pl-2 pb-2">
                                <div class="flex-1 flex flex-col justify-end items-center">
                                    <div class="w-full bg-green-500 rounded-t" style="height: 85%"></div>
                                    <span class="text-xs mt-1 font-medium">Week 1</span>
                                </div>
                                <div class="flex-1 flex flex-col justify-end items-center">
                                    <div class="w-full bg-green-500 rounded-t" style="height: 82%"></div>
                                    <span class="text-xs mt-1 font-medium">Week 2</span>
                                </div>
                                <div class="flex-1 flex flex-col justify-end items-center">
                                    <div class="w-full bg-green-500 rounded-t" style="height: 88%"></div>
                                    <span class="text-xs mt-1 font-medium">Week 3</span>
                                </div>
                                <div class="flex-1 flex flex-col justify-end items-center">
                                    <div class="w-full bg-green-500 rounded-t" style="height: 87%"></div>
                                    <span class="text-xs mt-1 font-medium">Week 4</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-center gap-4 text-sm">
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                                    <span>Compliance %</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 border-2 border-red-500"></div>
                                    <span>Target (85%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grade Distribution -->
                    <div class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i data-lucide="pie-chart" class="w-5 h-5 text-blue-600"></i>
                            Grade Distribution - Current Month
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Grade A (Excellent)</span>
                                    <span class="font-bold">856 units (60.3%)</span>
                                </div>
                                <div class="h-8 bg-gray-200 rounded-lg relative overflow-hidden">
                                    <div class="h-8 bg-green-500 rounded-lg flex items-center justify-center text-white text-xs font-bold" style="width: 60.3%">
                                        60.3%
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Grade B (Good)</span>
                                    <span class="font-bold">462 units (32.5%)</span>
                                </div>
                                <div class="h-8 bg-gray-200 rounded-lg relative overflow-hidden">
                                    <div class="h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-xs font-bold" style="width: 32.5%">
                                        32.5%
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Grade C (Alert)</span>
                                    <span class="font-bold">79 units (5.6%)</span>
                                </div>
                                <div class="h-8 bg-gray-200 rounded-lg relative overflow-hidden">
                                    <div class="h-8 bg-yellow-500 rounded-lg flex items-center justify-center text-white text-xs font-bold" style="width: 5.6%">
                                        5.6%
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Grade D (Hold)</span>
                                    <span class="font-bold">23 units (1.6%)</span>
                                </div>
                                <div class="h-8 bg-gray-200 rounded-lg relative overflow-hidden">
                                    <div class="h-8 bg-red-500 rounded-lg flex items-center justify-center text-white text-xs font-bold" style="width: 1.6%">
                                        1.6%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Deviation Trend Graph -->
                <div class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5 text-blue-600"></i>
                        Deviation Trend by Parameter - Last 7 Days
                    </h3>
                    <div class="overflow-x-auto">
                        <div class="flex items-end justify-between h-64 border-l-2 border-b-2 border-gray-400 pl-2 pb-2 min-w-[800px]">
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 92%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Width</div>
                                        <div class="text-xs text-gray-600">92%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 88%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Height</div>
                                        <div class="text-xs text-gray-600">88%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 95%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Diameter</div>
                                        <div class="text-xs text-gray-600">95%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-yellow-500 rounded-t" style="height: 79%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Weight</div>
                                        <div class="text-xs text-yellow-600">79%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 91%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Tread Depth</div>
                                        <div class="text-xs text-gray-600">91%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 84%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Pressure</div>
                                        <div class="text-xs text-gray-600">84%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 px-2">
                                <div class="space-y-1">
                                    <div class="flex flex-col items-center justify-end h-56">
                                        <div class="w-full bg-green-500 rounded-t" style="height: 93%"></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs font-medium">Hardness</div>
                                        <div class="text-xs text-gray-600">93%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-center gap-4 text-sm mt-4">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-green-500 rounded"></div>
                                <span>Compliant (&gt;85%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-yellow-500 rounded"></div>
                                <span>Alert (70-85%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 bg-red-500 rounded"></div>
                                <span>Critical (&lt;70%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="content-reports" class="hidden space-y-6">
                <div class="bg-white p-6 rounded-xl border-2 border-gray-200 shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-3">
                        <i data-lucide="file-bar-chart" class="w-6 h-6 text-blue-600"></i>
                        Report Generation
                    </h2>
                    <p class="text-gray-600">Advanced report generation features coming soon...</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white text-center p-4 mt-8">
            <p class="text-sm">© 2026 Tyre Analysis System | Enterprise Edition v2.0</p>
        </footer>
    </div>

    <!-- Activation Modal -->
    <div id="activationModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
            <div class="bg-gradient-to-r from-blue-700 to-blue-600 text-white p-6 rounded-t-xl">
                <h2 class="text-xl font-bold">Activate Target Specifications</h2>
                <p class="text-sm text-blue-100 mt-2">Set the effective date from which these target specifications will be used by the BTP team.</p>
            </div>
            
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-semibold mb-2 text-gray-700">📅 Effective From Date</label>
                    <input type="date" id="effectiveDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:ring-2 focus:ring-blue-200">
                    <p class="text-xs text-gray-500 mt-2">By default, today's date is selected. BTP actual entries will follow these specs from the selected date onward.</p>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-600 p-4 rounded-lg mb-6">
                    <p class="text-sm text-yellow-800 flex items-center gap-2">
                        <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                        Are you sure you want to activate these target specifications? This action will impact all BTP actual measurements from the selected date.
                    </p>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-b-xl flex justify-between items-center border-t-2 border-gray-200">
                <p class="text-xs text-gray-600">You can update the effective date later from the configuration history if required.</p>
                <div class="flex gap-3">
                    <button onclick="cancelActivation()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold">Cancel</button>
                    <button onclick="confirmActivation()" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-semibold">Confirm & Activate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grade Details Modal (from comparison system) -->
    <div id="gradeDetailsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <div class="bg-gradient-to-r from-blue-700 to-blue-600 text-white p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i data-lucide="clipboard-check" class="w-6 h-6"></i>
                    <div>
                        <h3 class="text-xl font-bold" id="modalRecipeName">Complete Grade Analysis</h3>
                        <p class="text-sm text-blue-100" id="modalRecipeSubtitle">Detailed Parameter Comparison</p>
                    </div>
                </div>
                <button onclick="closeGradeModal()" class="text-white hover:bg-blue-800 rounded-full p-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="bg-gradient-to-r from-gray-50 to-white p-6 border-b-2 border-gray-200">
                <div class="grid grid-cols-5 gap-4">
                    <div class="text-center">
                        <div class="text-sm text-gray-600 mb-2">Overall Grade</div>
                        <div id="modalOverallGrade" class="inline-block px-6 py-3 rounded-lg font-bold text-white text-3xl bg-green-600">A</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600 mb-2">Grade A</div>
                        <div class="text-2xl font-bold text-green-700" id="modalGradeA">0</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600 mb-2">Grade B</div>
                        <div class="text-2xl font-bold text-blue-700" id="modalGradeB">0</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600 mb-2">Grade C</div>
                        <div class="text-2xl font-bold text-yellow-700" id="modalGradeC">0</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600 mb-2">Grade D</div>
                        <div class="text-2xl font-bold text-red-700" id="modalGradeD">0</div>
                    </div>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 280px);">
                <table class="w-full border-collapse">
                    <thead class="sticky top-0 bg-gray-100 z-10">
                        <tr class="bg-gray-200">
                            <th class="border-2 border-gray-300 p-3 text-left">Parameter Name</th>
                            <th class="border-2 border-gray-300 p-3 text-left bg-blue-50">Master Data</th>
                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 1</th>
                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 2</th>
                            <th class="border-2 border-gray-300 p-3 text-center bg-green-50">Section 3</th>
                            <th class="border-2 border-gray-300 p-3 text-center">Grade</th>
                        </tr>
                    </thead>
                    <tbody id="modalTableBody">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="bg-gray-100 p-4 flex justify-between items-center border-t-2 border-gray-200">
                <button onclick="exportGradeData()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    Export Data
                </button>
                <button onclick="closeGradeModal()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ===========================
        // DATA STRUCTURES
        // ===========================
        
        const RECIPES_DATA = [
            {
                id: 'recipe-a',
                name: 'Recipe A - Standard Compound',
                description: 'Standard formulation for everyday tire production',
                versions: ['v1.0', 'v1.1', 'v1.2', 'v1.3']
            },
            {
                id: 'recipe-b',
                name: 'Recipe B - High Performance',
                description: 'Enhanced grip and handling characteristics',
                versions: ['v2.0', 'v2.1', 'v2.2']
            },
            {
                id: 'recipe-c',
                name: 'Recipe C - All Weather',
                description: 'Optimized for all-season performance',
                versions: ['v3.0', 'v3.1', 'v3.2']
            },
            {
                id: 'recipe-d',
                name: 'Recipe D - Heavy Duty',
                description: 'Reinforced compound for heavy loads',
                versions: ['v1.0', 'v1.1', 'v1.2', 'v1.3', 'v1.4', 'v1.5']
            },
            {
                id: 'recipe-e',
                name: 'Recipe E - Eco Friendly',
                description: 'Low rolling resistance, fuel efficient',
                versions: ['v2.0', 'v2.1']
            },
            {
                id: 'recipe-f',
                name: 'Recipe F - Winter Special',
                description: 'Cold weather optimized formulation',
                versions: ['v4.0', 'v4.1', 'v4.2']
            }
        ];

        const PARAMETERS = [
            'Overall Tread Center Gauge',
            'Overall Shoulder Gauge SS',
            'Overall Shoulder Gauge OSS',
            'Tread Center Rubber Gauge',
            'Tread shoulder Rubber gauge SS',
            'Tread shoulder Rubber gauge OSS',
            'Under Tread 1 at Center',
            'Under Tread 2 at Shoulder SS',
            'Under Tread 2 at Shoulder OSS',
            'Inner Liner gauge at shoulders SS',
            'Inner Liner gauge at shoulders OSS',
            'Belt 1 Width',
            'Belt 2 Width',
            'Belt 1 Centering SS',
            'Belt 1 Centering OSS',
            'Belt 2 Centering SS',
            'Belt 2 Centering OSS',
            'Half Width of capstrip SS',
            'Half Width of capstrip OSS',
            'Pad Gauge SS',
            'Pad Gauge OSS',
            'Mid Sidewall Rubber Gauge SS',
            'Mid Sidewall Rubber Gauge OSS',
            'Rim strip height SS',
            'Rim strip height OSS',
            'SW ending from heel SS',
            'SW ending from heel OSS',
            'Filler Height SS',
            'Filler Height OSS',
            'Ply 1 turn-up height SS',
            'Ply 1 turn-up height OSS',
            'Ply 2 turn-up height SS',
            'Ply 2 turn-up height OSS',
            'Overall Bead width SS',
            'Overall Bead width OSS',
            'Chimney Position on Rib',
            'Bead Construction',
            'Toe-Toe Distance',
            'Rubber Gauge at bead ( Bead ring line) SS',
            'Rubber Gauge at bead ( Bead ring line) OSS',
            'Material Gauge under the bead SS',
            'Material Gauge under the bead OSS',
            'UT gauge above cap ply @ shoulder SS',
            'UT gauge above cap ply @ shoulder OSS'
        ];

        const BTP_RECIPE_STATUS = {
            'recipe-a': 'completed',
            'recipe-b': 'pending',
            'recipe-c': 'completed',
            'recipe-d': 'pending',
            'recipe-e': 'pending',
            'recipe-f': 'completed'
        };

        // Version data for comparison system
        const versionData = {
            v5: {
                parameters: [
                    { name: 'Overall Tread Center Gauge', master: '12.5mm ±0.5', section1: '12.6mm', section2: '12.7mm', section3: '12.6mm', grade1: 'A', grade2: 'A', grade3: 'A', overallGrade: 'A' },
                    { name: 'Overall Shoulder Gauge SS', master: '11.0mm ±0.4', section1: '11.2mm', section2: '11.3mm', section3: '11.4mm', grade1: 'B', grade2: 'B', grade3: 'C', overallGrade: 'B' },
                    // ... (rest of parameters from the comparison system)
                ]
            },
            v4: {
                parameters: [
                    // Historical version data
                ]
            }
        };

        // Application state
        let appState = {
            currentTab: 'rpscoe',
            rpscoe: {
                selectedRecipe: null,
                selectedVersion: null,
                parameterData: []
            },
            btp: {
                selectedRecipe: null,
                selectedVersion: null
            },
            comparison: {
                selectedRecipe: null,
                currentVersion: 'v5'
            }
        };

        // ===========================
        // INITIALIZATION
        // ===========================
        
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            populateDropdowns();
        });

        function populateDropdowns() {
            const rpscoeSelect = document.getElementById('rpscoeRecipeSelect');
            const btpSelect = document.getElementById('btpRecipeSelect');
            const comparisonSelect = document.getElementById('comparisonRecipeSelect');
            
            const options = RECIPES_DATA.map(recipe => 
                `<option value="${recipe.id}">${recipe.name}</option>`
            ).join('');
            
            if (rpscoeSelect) rpscoeSelect.innerHTML = '<option value="">Select Recipe</option>' + options;
            if (btpSelect) btpSelect.innerHTML = '<option value="">Select Recipe</option>' + options;
            if (comparisonSelect) comparisonSelect.innerHTML = '<option value="">Select Recipe</option>' + options;
            
            renderRecipeCards();
            setDefaultEffectiveDate();
        }

        function setDefaultEffectiveDate() {
            const today = new Date().toISOString().split('T')[0];
            const effectiveDateInput = document.getElementById('effectiveDate');
            if (effectiveDateInput) effectiveDateInput.value = today;
        }

        // ===========================
        // LOGIN / LOGOUT
        // ===========================
        
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            if (!username || !password || !role) {
                alert('Please fill in all fields');
                return;
            }
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userRoleDisplay').textContent = role === 'rpscoe' ? 'RPSCoE' : 
                                                                      role === 'btp-quality' ? 'BTP Quality' : 'BTP Technical';
            lucide.createIcons();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginRole').value = '';
                resetApplication();
                lucide.createIcons();
            }
        }

        function resetApplication() {
            appState = {
                currentTab: 'rpscoe',
                rpscoe: { selectedRecipe: null, selectedVersion: null, parameterData: [] },
                btp: { selectedRecipe: null, selectedVersion: null },
                comparison: { selectedRecipe: null, currentVersion: 'v5' }
            };
        }

        // ===========================
        // TAB SWITCHING
        // ===========================
        
        function switchTab(tabId) {
            appState.currentTab = tabId;
            
            // Update tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.className = 'px-6 py-2.5 rounded-lg flex items-center gap-2 bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold transition-all';
            });
            document.getElementById('tab-' + tabId).className = 'px-6 py-2.5 rounded-lg flex items-center gap-2 bg-blue-600 text-white font-semibold transition-all';
            
            // Update content
            document.querySelectorAll('[id^="content-"]').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById('content-' + tabId).classList.remove('hidden');
            
            lucide.createIcons();
        }

        // ===========================
        // RPSCOE FUNCTIONS
        // ===========================
        
        function renderRecipeCards() {
            const rpscoeContainer = document.getElementById('rpscoeRecipeListContainer');
            const btpContainer = document.getElementById('btpRecipeListContainer');
            
            if (rpscoeContainer) {
                rpscoeContainer.innerHTML = RECIPES_DATA.map(recipe => `
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-blue-600 hover:shadow-lg transition-all cursor-pointer" onclick="selectRecipeCard('${recipe.id}', 'rpscoe')">
                        <h4 class="font-bold text-lg text-gray-800 mb-2">${recipe.name.split(' - ')[0]}</h4>
                        <p class="text-sm text-gray-600 mb-3">${recipe.description}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-blue-600 font-semibold">44 Parameters</span>
                            <i data-lucide="arrow-right" class="w-4 h-4 text-blue-600"></i>
                        </div>
                    </div>
                `).join('');
            }
            
            if (btpContainer) {
                btpContainer.innerHTML = RECIPES_DATA.map(recipe => {
                    const status = BTP_RECIPE_STATUS[recipe.id] || 'pending';
                    const statusClass = `status-${status}`;
                    const statusText = status === 'completed' ? 'Completed' : 'Pending';
                    const statusBadgeClass = `recipe-status-${status}`;
                    
                    return `
                        <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-blue-600 hover:shadow-lg transition-all cursor-pointer relative ${statusClass}" onclick="selectRecipeCard('${recipe.id}', 'btp')">
                            <span class="recipe-status-badge ${statusBadgeClass}">${statusText}</span>
                            <h4 class="font-bold text-lg text-gray-800 mb-2">${recipe.name.split(' - ')[0]}</h4>
                            <p class="text-sm text-gray-600 mb-3">${recipe.description}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-blue-600 font-semibold">44 Parameters</span>
                                <i data-lucide="arrow-right" class="w-4 h-4 text-blue-600"></i>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            lucide.createIcons();
        }

        function selectRecipeCard(recipeId, tab) {
            if (tab === 'rpscoe') {
                document.getElementById('rpscoeRecipeSelect').value = recipeId;
                handleRPSCoERecipeChange();
            } else {
                document.getElementById('btpRecipeSelect').value = recipeId;
                handleBTPRecipeChange();
            }
        }

        function handleRPSCoERecipeChange() {
            const recipeId = document.getElementById('rpscoeRecipeSelect').value;
            const recipe = RECIPES_DATA.find(r => r.id === recipeId);
            const saveBtn = document.getElementById('saveTargetSpecsBtn');
            
            if (recipe) {
                appState.rpscoe.selectedRecipe = recipe;
                appState.rpscoe.selectedVersion = recipe.versions[recipe.versions.length - 1];
                appState.rpscoe.parameterData = generateParameterData();
                
                // Show work area, hide recipe list
                document.getElementById('rpscoeWorkArea').style.display = 'grid';
                document.getElementById('rpscoeRecipeList').style.display = 'none';
                
                // Enable Save Target Specs button
                saveBtn.disabled = false;
                saveBtn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed', 'disabled:from-gray-400', 'disabled:to-gray-500');
                saveBtn.classList.add('hover:from-blue-700', 'hover:to-blue-800');
                
                // Populate version dropdown
                const versionSelect = document.getElementById('rpscoeVersionSelect');
                versionSelect.disabled = false;
                versionSelect.innerHTML = '<option value="">Select Version</option>' + 
                    recipe.versions.map(v => `<option value="${v}" ${v === appState.rpscoe.selectedVersion ? 'selected' : ''}>${v}</option>`).join('');
                
                renderRPSCoEParameters();
            } else {
                document.getElementById('rpscoeWorkArea').style.display = 'none';
                document.getElementById('rpscoeRecipeList').style.display = 'block';
                
                // Disable Save Target Specs button
                saveBtn.disabled = true;
                saveBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed', 'disabled:from-gray-400', 'disabled:to-gray-500');
                saveBtn.classList.remove('hover:from-blue-700', 'hover:to-blue-800');
            }
            
            lucide.createIcons();
        }

        function generateParameterData() {
            return PARAMETERS.map((param, index) => {
                const targetSpec = (index % 7 === 0) ? null : `${(Math.random() * 100 + 50).toFixed(2)} ${['mm', 'MPa', '%', '°C', 'phr'][index % 5]}`;
                return {
                    name: param,
                    targetSpec: targetSpec,
                    id: `param_${index}`
                };
            });
        }

        function renderRPSCoEParameters() {
            const tbody = document.getElementById('rpscoeParametersBody');
            tbody.innerHTML = appState.rpscoe.parameterData.map(param => {
                const isNull = param.targetSpec === null || param.targetSpec === '';
                const rowClass = isNull ? 'row-null' : '';
                const cellClass = isNull ? 'cell-null' : '';
                const displayValue = isNull ? 'Null' : param.targetSpec;
                
                return `
                    <tr class="${rowClass}">
                        <td class="border-b border-gray-200">${param.name}</td>
                        <td class="border-b border-gray-200 ${cellClass}" id="spec-${param.id}">${displayValue}</td>
                        <td class="border-b border-gray-200 text-center">
                            <span class="edit-icon inline-flex" onclick="enableInlineEdit('${param.id}')">
                                <i data-lucide="pencil" class="w-4 h-4"></i>
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function enableInlineEdit(paramId) {
            const param = appState.rpscoe.parameterData.find(p => p.id === paramId);
            if (!param) return;
            
            const cell = document.getElementById(`spec-${paramId}`);
            const currentValue = param.targetSpec || '';
            
            cell.innerHTML = `
                <input 
                    type="text" 
                    class="inline-edit-input" 
                    id="edit-input-${paramId}" 
                    value="${currentValue}"
                    onkeypress="if(event.key==='Enter') saveInlineEdit('${paramId}')"
                    onblur="saveInlineEdit('${paramId}')"
                >
            `;
            
            document.getElementById(`edit-input-${paramId}`).focus();
        }

        function saveInlineEdit(paramId) {
            const input = document.getElementById(`edit-input-${paramId}`);
            if (!input) return;
            
            const newValue = input.value.trim();
            const param = appState.rpscoe.parameterData.find(p => p.id === paramId);
            if (param) {
                param.targetSpec = newValue || null;
            }
            
            renderRPSCoEParameters();
        }

        function resetRPSCoE() {
            appState.rpscoe = { selectedRecipe: null, selectedVersion: null, parameterData: [] };
            document.getElementById('rpscoeRecipeSelect').value = '';
            document.getElementById('rpscoeVersionSelect').value = '';
            document.getElementById('rpscoeVersionSelect').disabled = true;
            document.getElementById('rpscoeWorkArea').style.display = 'none';
            document.getElementById('rpscoeRecipeList').style.display = 'block';
            
            // Disable Save Target Specs button
            const saveBtn = document.getElementById('saveTargetSpecsBtn');
            saveBtn.disabled = true;
            saveBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed', 'disabled:from-gray-400', 'disabled:to-gray-500');
            saveBtn.classList.remove('hover:from-blue-700', 'hover:to-blue-800');
        }

        function saveTargetSpecs() {
            if (!appState.rpscoe.selectedRecipe) {
                alert('Please select a recipe first.');
                return;
            }
            
            document.getElementById('activationModal').classList.remove('hidden');
            lucide.createIcons();
        }

        function cancelActivation() {
            document.getElementById('activationModal').classList.add('hidden');
        }

        function confirmActivation() {
            const effectiveDate = document.getElementById('effectiveDate').value;
            
            if (!effectiveDate) {
                alert('Please select an effective date.');
                return;
            }
            
            const nullParams = appState.rpscoe.parameterData.filter(p => p.targetSpec === null);
            if (nullParams.length > 0) {
                const confirmSave = confirm(
                    `Warning: ${nullParams.length} parameter(s) have NULL values.\n\nDo you want to activate anyway?`
                );
                if (!confirmSave) return;
            }
            
            document.getElementById('activationModal').classList.add('hidden');
            alert(`Target specifications activated successfully!\n\nRecipe: ${appState.rpscoe.selectedRecipe.name}\nEffective From: ${effectiveDate}`);
        }

        // ===========================
        // BTP FUNCTIONS
        // ===========================
        
        function handleBTPRecipeChange() {
            const recipeId = document.getElementById('btpRecipeSelect').value;
            const recipe = RECIPES_DATA.find(r => r.id === recipeId);
            
            if (recipe) {
                appState.btp.selectedRecipe = recipe;
                appState.btp.selectedVersion = recipe.versions[recipe.versions.length - 1];
                
                document.getElementById('btpWorkArea').style.display = 'grid';
                document.getElementById('btpRecipeList').style.display = 'none';
                
                const versionSelect = document.getElementById('btpVersionSelect');
                versionSelect.disabled = false;
                versionSelect.innerHTML = '<option value="">Select Version</option>' + 
                    recipe.versions.map(v => `<option value="${v}" ${v === appState.btp.selectedVersion ? 'selected' : ''}>${v}</option>`).join('');
                
                renderBTPMeasurements();
                renderBTPPendingScans();
            } else {
                document.getElementById('btpWorkArea').style.display = 'none';
                document.getElementById('btpRecipeList').style.display = 'block';
            }
            
            lucide.createIcons();
        }

        function renderBTPMeasurements() {
            const tbody = document.getElementById('btpMeasurementsBody');
            
            tbody.innerHTML = PARAMETERS.map(param => {
                const baseValue = (Math.random() * 10 + 5).toFixed(2);
                const actual1 = (parseFloat(baseValue) + (Math.random() - 0.5) * 0.2).toFixed(2);
                const actual2 = (parseFloat(baseValue) + (Math.random() - 0.5) * 0.2).toFixed(2);
                const actual3 = (parseFloat(baseValue) + (Math.random() - 0.5) * 0.2).toFixed(2);
                const status = ['green', 'green', 'green', 'yellow', 'red'][Math.floor(Math.random() * 5)];
                const statusColor = status === 'green' ? 'bg-green-100 text-green-800' :
                                   status === 'yellow' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="border-b border-gray-200">${param}</td>
                        <td class="border-b border-gray-200">${baseValue} mm</td>
                        <td class="border-b border-gray-200 text-center ${statusColor} font-semibold">${actual1}</td>
                        <td class="border-b border-gray-200 text-center ${statusColor} font-semibold">${actual2}</td>
                        <td class="border-b border-gray-200 text-center ${statusColor} font-semibold">${actual3}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderBTPPendingScans() {
            const container = document.getElementById('btpPendingScans');
            const pendingRecipes = RECIPES_DATA.filter(recipe => BTP_RECIPE_STATUS[recipe.id] === 'pending');
            
            if (pendingRecipes.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">✓ All recipes completed</div>';
                return;
            }
            
            container.innerHTML = pendingRecipes.map(recipe => `
                <div class="flex items-center justify-between p-3 bg-yellow-50 border-l-4 border-yellow-600 rounded-lg">
                    <span class="text-sm font-medium text-gray-800">${recipe.name}</span>
                    <span class="px-3 py-1 bg-yellow-600 text-white text-xs font-bold rounded-full">Pending</span>
                </div>
            `).join('');
        }

        function resetBTP() {
            appState.btp = { selectedRecipe: null, selectedVersion: null };
            document.getElementById('btpRecipeSelect').value = '';
            document.getElementById('btpVersionSelect').value = '';
            document.getElementById('btpVersionSelect').disabled = true;
            document.getElementById('btpWorkArea').style.display = 'none';
            document.getElementById('btpRecipeList').style.display = 'block';
        }

        // ===========================
        // COMPARISON TAB FUNCTIONS
        // ===========================
        
        function handleComparisonRecipeChange() {
            const recipeId = document.getElementById('comparisonRecipeSelect').value;
            appState.comparison.selectedRecipe = recipeId;
            
            if (recipeId) {
                document.getElementById('versionControls').classList.remove('hidden');
                document.getElementById('versionControls').classList.add('flex');
            } else {
                document.getElementById('versionControls').classList.add('hidden');
                document.getElementById('versionControls').classList.remove('flex');
            }
            
            updateVersionIndicator();
            updateDataComparisonView();
        }

        function handleVersionChange() {
            appState.comparison.currentVersion = document.getElementById('versionSelect').value;
            updateVersionIndicator();
            updateDataComparisonView();
        }

        function updateVersionIndicator() {
            const indicator = document.getElementById('versionIndicator');
            const historicalAlert = document.getElementById('historicalAlert');
            
            if (!appState.comparison.selectedRecipe) {
                indicator.classList.add('hidden');
                historicalAlert.classList.add('hidden');
                return;
            }
            
            indicator.classList.remove('hidden');
            indicator.classList.add('flex');
            
            if (appState.comparison.currentVersion === 'v5') {
                indicator.className = 'flex items-center gap-2 px-3 py-2 rounded bg-green-100 border-2 border-green-500';
                indicator.innerHTML = `
                    <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                    <span class="text-xs font-bold text-green-700">LATEST</span>
                `;
                historicalAlert.classList.add('hidden');
            } else {
                indicator.className = 'flex items-center gap-2 px-3 py-2 rounded bg-yellow-100 border-2 border-yellow-500';
                indicator.innerHTML = `
                    <i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-600"></i>
                    <span class="text-xs font-bold text-yellow-700">HISTORICAL</span>
                `;
                historicalAlert.classList.remove('hidden');
            }
            
            lucide.createIcons();
        }

        function updateDataComparisonView() {
            // Implement comparison view logic here
            // This would populate the comparison tables based on selected recipe and version
        }

        function loadLatestVersion() {
            appState.comparison.currentVersion = 'v5';
            document.getElementById('versionSelect').value = 'v5';
            updateVersionIndicator();
            updateDataComparisonView();
        }

        function openVersionHistory() {
            alert('Version history panel would open here');
        }

        function openGradeModal(recipeId) {
            document.getElementById('gradeDetailsModal').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeGradeModal() {
            document.getElementById('gradeDetailsModal').classList.add('hidden');
        }

        function exportGradeData() {
            alert('Export functionality will download data as CSV/Excel file');
        }

        // ===========================
        // LOG HISTORY
        // ===========================
        
        function openLogHistory(tab) {
            alert(`Log history for ${tab} would open here`);
        }
    </script>
</body>
</html>
